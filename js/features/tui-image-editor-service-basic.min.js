/*!
 * Start Bootstrap - SB Admin 2 v4.0.4 (https://startbootstrap.com/template-overviews/sb-admin-2)
 * Copyright 2013-2019 Start Bootstrap
 * Licensed under MIT (https://github.com/BlackrockDigital/startbootstrap-sb-admin-2/blob/master/LICENSE)
 */

"use strict";var shapeType,activeObjectId,supportingFileAPI=!!(window.File&&window.FileList&&window.FileReader),rImageType=/data:(image\/.+);base64,/,shapeOptions={},$btns=$(".menu-item"),$btnsActivatable=$btns.filter(".activatable"),$inputImage=$("#input-image-file"),$btnDownload=$("#btn-download"),$btnUndo=$("#btn-undo"),$btnRedo=$("#btn-redo"),$btnReset=$("#btn-reset"),$btnClearObjects=$("#btn-clear-objects"),$btnRemoveActiveObject=$("#btn-remove-active-object"),$btnCrop=$("#btn-crop"),$btnFlip=$("#btn-flip"),$btnRotation=$("#btn-rotation"),$btnDrawLine=$("#btn-draw-line"),$btnDrawShape=$("#btn-draw-shape"),$btnApplyCrop=$("#btn-apply-crop"),$btnCancelCrop=$("#btn-cancel-crop"),$btnFlipX=$("#btn-flip-x"),$btnFlipY=$("#btn-flip-y"),$btnResetFlip=$("#btn-reset-flip"),$btnRotateClockwise=$("#btn-rotate-clockwise"),$btnRotateCounterClockWise=$("#btn-rotate-counter-clockwise"),$btnText=$("#btn-text"),$btnTextStyle=$(".btn-text-style"),$btnAddIcon=$("#btn-add-icon"),$btnRegisterIcon=$("#btn-register-icon"),$btnMaskFilter=$("#btn-mask-filter"),$btnImageFilter=$("#btn-image-filter"),$btnLoadMaskImage=$("#input-mask-image-file"),$btnApplyMask=$("#btn-apply-mask"),$btnClose=$(".close"),$inputRotationRange=$("#input-rotation-range"),$inputBrushWidthRange=$("#input-brush-width-range"),$inputFontSizeRange=$("#input-font-size-range"),$inputStrokeWidthRange=$("#input-stroke-width-range"),$inputCheckTransparent=$("#input-check-transparent"),$inputCheckGrayscale=$("#input-check-grayscale"),$inputCheckInvert=$("#input-check-invert"),$inputCheckSepia=$("#input-check-sepia"),$inputCheckSepia2=$("#input-check-sepia2"),$inputCheckBlur=$("#input-check-blur"),$inputCheckSharpen=$("#input-check-sharpen"),$inputCheckEmboss=$("#input-check-emboss"),$inputCheckRemoveWhite=$("#input-check-remove-white"),$inputRangeRemoveWhiteThreshold=$("#input-range-remove-white-threshold"),$inputRangeRemoveWhiteDistance=$("#input-range-remove-white-distance"),$inputCheckBrightness=$("#input-check-brightness"),$inputRangeBrightnessValue=$("#input-range-brightness-value"),$inputCheckNoise=$("#input-check-noise"),$inputRangeNoiseValue=$("#input-range-noise-value"),$inputCheckGradientTransparency=$("#input-check-gradient-transparancy"),$inputRangeGradientTransparencyValue=$("#input-range-gradient-transparency-value"),$inputCheckPixelate=$("#input-check-pixelate"),$inputRangePixelateValue=$("#input-range-pixelate-value"),$inputCheckTint=$("#input-check-tint"),$inputRangeTintOpacityValue=$("#input-range-tint-opacity-value"),$inputCheckMultiply=$("#input-check-multiply"),$inputCheckBlend=$("#input-check-blend"),$inputCheckColorFilter=$("#input-check-color-filter"),$inputRangeColorFilterValue=$("#input-range-color-filter-value"),$displayingSubMenu=$(),$cropSubMenu=$("#crop-sub-menu"),$flipSubMenu=$("#flip-sub-menu"),$rotationSubMenu=$("#rotation-sub-menu"),$freeDrawingSubMenu=$("#free-drawing-sub-menu"),$drawLineSubMenu=$("#draw-line-sub-menu"),$drawShapeSubMenu=$("#draw-shape-sub-menu"),$textSubMenu=$("#text-sub-menu"),$iconSubMenu=$("#icon-sub-menu"),$filterSubMenu=$("#filter-sub-menu"),$imageFilterSubMenu=$("#image-filter-sub-menu"),$selectLine=$('[name="select-line-type"]'),$selectShapeType=$('[name="select-shape-type"]'),$selectColorType=$('[name="select-color-type"]'),$selectBlendType=$('[name="select-blend-type"]'),imageEditor=new tui.ImageEditor(".tui-image-editor",{cssMaxWidth:700,cssMaxHeight:500,selectionStyle:{cornerSize:20,rotatingPointOffset:70}}),brushColorpicker=tui.colorPicker.create({container:$("#tui-brush-color-picker")[0],color:"#000000"}),textColorpicker=tui.colorPicker.create({container:$("#tui-text-color-picker")[0],color:"#000000"}),shapeColorpicker=tui.colorPicker.create({container:$("#tui-shape-color-picker")[0],color:"#000000"}),tintColorpicker=tui.colorPicker.create({container:$("#tui-tint-color-picker")[0],color:"#000000"}),multiplyColorpicker=tui.colorPicker.create({container:$("#tui-multiply-color-picker")[0],color:"#000000"}),blendColorpicker=tui.colorPicker.create({container:$("#tui-blend-color-picker")[0],color:"#00FF00"});function hexToRGBa(e,t){return"rgba("+parseInt(e.slice(1,3),16)+", "+parseInt(e.slice(3,5),16)+", "+parseInt(e.slice(5,7),16)+", "+(t||1)+")"}function base64ToBlob(e){var t,n,i,o,a="";for(t=e.replace(rImageType,function(e,t){return a=t,""}),o=(t=atob(t)).length,n=new Uint8Array(o),i=0;i<o;i+=1)n[i]=t.charCodeAt(i);return new Blob([n],{type:a})}function resizeEditor(){var e=$(".tui-image-editor"),t=$(".tui-image-editor-canvas-container"),n=parseFloat(t.css("max-height"));e.height(n)}function getBrushSettings(){return{width:$inputBrushWidthRange.val(),color:hexToRGBa(brushColorpicker.getColor(),.5)}}function activateShapeMode(){"SHAPE"!==imageEditor.getDrawingMode()&&(imageEditor.stopDrawingMode(),imageEditor.startDrawingMode("SHAPE"))}function activateIconMode(){imageEditor.stopDrawingMode()}function activateTextMode(){"TEXT"!==imageEditor.getDrawingMode()&&(imageEditor.stopDrawingMode(),imageEditor.startDrawingMode("TEXT"))}function setTextToolbar(e){var t=e.fontSize,n=e.fill;$inputFontSizeRange.val(t),textColorpicker.setColor(n)}function setIconToolbar(e){var t=e.fill;iconColorpicker.setColor(t)}function setShapeToolbar(e){var t,n,i,o=$selectColorType.val();"stroke"===o?(i="transparent"===(t=e.stroke))||shapeColorpicker.setColor(t):"fill"===o&&((i="transparent"===(n=e.fill))||shapeColorpicker.setColor(n)),$inputCheckTransparent.prop("checked",i),$inputStrokeWidthRange.val(e.strokeWidth)}function showSubMenu(e){var t;switch(e){case"shape":t=$drawShapeSubMenu;break;case"icon":t=$iconSubMenu;break;case"text":t=$textSubMenu;break;default:t=0}$displayingSubMenu.hide(),$displayingSubMenu=t.show()}function applyOrRemoveFilter(e,t,n){e?imageEditor.applyFilter(t,n).then(function(e){console.log(e)}):imageEditor.removeFilter(t)}function reset(){imageEditor.undo().then(function(){imageEditor.isEmptyUndoStack()||reset()},function(){}),$btnReset.addClass("disabled")}function onClickIconSubMenu(e){var t=e.target||e.srcElement,n=$(t).attr("data-icon-type");imageEditor.once("mousedown",function(e,t){imageEditor.addIcon(n,{left:t.x,top:t.y}).then(function(e){})})}imageEditor.on({objectAdded:function(e){console.info(e)},undoStackChanged:function(e){e?($btnUndo.removeClass("disabled"),$btnReset.removeClass("disabled")):($btnUndo.addClass("disabled"),$btnReset.addClass("disabled")),resizeEditor()},redoStackChanged:function(e){e?$btnRedo.removeClass("disabled"):$btnRedo.addClass("disabled"),resizeEditor()},objectScaled:function(e){"text"===e.type&&$inputFontSizeRange.val(e.fontSize)},addText:function(e){imageEditor.addText("Double Click",{position:e.originPosition}).then(function(e){console.log(e)})},objectActivated:function(e){activeObjectId=e.id,"rect"===e.type||"circle"===e.type||"triangle"===e.type?(showSubMenu("shape"),setShapeToolbar(e),activateShapeMode()):"icon"===e.type?(showSubMenu("icon"),setIconToolbar(e),activateIconMode()):"text"===e.type&&(showSubMenu("text"),setTextToolbar(e),activateTextMode())},mousedown:function(e,t){$imageFilterSubMenu.is(":visible")&&imageEditor.hasFilter("colorFilter")&&imageEditor.applyFilter("colorFilter",{x:parseInt(t.x,10),y:parseInt(t.y,10)})}}),$btns.on("click",function(){$btnsActivatable.removeClass("active")}),$btnsActivatable.on("click",function(){$(this).addClass("active")}),$btnUndo.on("click",function(){$displayingSubMenu.hide(),$(this).hasClass("disabled")||imageEditor.undo().then(function(){},function(){})}),$btnRedo.on("click",function(){$displayingSubMenu.hide(),$(this).hasClass("disabled")||imageEditor.redo().then(function(){},function(){})}),$btnReset.on("click",function(){$displayingSubMenu.hide(),$(this).hasClass("disabled")||reset()}),$btnClearObjects.on("click",function(){$displayingSubMenu.hide(),imageEditor.clearObjects()}),$btnRemoveActiveObject.on("click",function(){$displayingSubMenu.hide(),imageEditor.removeObject(activeObjectId)}),$btnCrop.on("click",function(){imageEditor.startDrawingMode("CROPPER"),$displayingSubMenu.hide(),$displayingSubMenu=$cropSubMenu.show()}),$btnFlip.on("click",function(){imageEditor.stopDrawingMode(),$displayingSubMenu.hide(),$displayingSubMenu=$flipSubMenu.show()}),$btnRotation.on("click",function(){imageEditor.stopDrawingMode(),$displayingSubMenu.hide(),$displayingSubMenu=$rotationSubMenu.show()}),$btnClose.on("click",function(){imageEditor.stopDrawingMode(),$displayingSubMenu.hide()}),$btnApplyCrop.on("click",function(){imageEditor.crop(imageEditor.getCropzoneRect()).then(function(){imageEditor.stopDrawingMode(),resizeEditor()})}),$btnCancelCrop.on("click",function(){imageEditor.stopDrawingMode(),$displayingSubMenu.hide()}),$btnFlipX.on("click",function(){imageEditor.flipX().then(function(e){console.log("flipX: ",e.flipX),console.log("flipY: ",e.flipY),console.log("angle: ",e.angle)})}),$btnFlipY.on("click",function(){imageEditor.flipY().then(function(e){console.log("flipX: ",e.flipX),console.log("flipY: ",e.flipY),console.log("angle: ",e.angle)})}),$btnResetFlip.on("click",function(){imageEditor.resetFlip().then(function(e){console.log("flipX: ",e.flipX),console.log("flipY: ",e.flipY),console.log("angle: ",e.angle)})}),$btnRotateClockwise.on("click",function(){imageEditor.rotate(30)}),$btnRotateCounterClockWise.on("click",function(){imageEditor.rotate(-30)}),$inputRotationRange.on("mousedown",function(){function t(){imageEditor.setAngle(parseInt($inputRotationRange.val(),10)).catch(function(){})}$(document).on("mousemove",t),$(document).on("mouseup",function e(){$(document).off("mousemove",t),$(document).off("mouseup",e)})}),$inputRotationRange.on("change",function(){imageEditor.setAngle(parseInt($inputRotationRange.val(),10)).catch(function(){})}),$inputBrushWidthRange.on("change",function(){imageEditor.setBrush({width:parseInt(this.value,10)})}),$inputImage.on("change",function(e){var t;supportingFileAPI||alert("This browser does not support file-api"),t=e.target.files[0],imageEditor.loadImageFromFile(t).then(function(e){console.log(e),imageEditor.clearUndoStack()})}),$btnDownload.on("click",function(){var e,t,n=imageEditor.getImageName(),i=imageEditor.toDataURL();supportingFileAPI?(t=(e=base64ToBlob(i)).type.split("/")[1],n.split(".").pop()!==t&&(n+="."+t),saveAs(e,n)):(alert("This browser needs a file-server"),window.open().document.body.innerHTML="<img src="+i+">")}),$btnDrawLine.on("click",function(){imageEditor.stopDrawingMode(),$displayingSubMenu.hide(),$displayingSubMenu=$drawLineSubMenu.show(),$selectLine.eq(0).change()}),$selectLine.on("change",function(){var e=$(this).val(),t=getBrushSettings();imageEditor.stopDrawingMode(),"freeDrawing"===e?imageEditor.startDrawingMode("FREE_DRAWING",t):imageEditor.startDrawingMode("LINE_DRAWING",t)}),brushColorpicker.on("selectColor",function(e){imageEditor.setBrush({color:hexToRGBa(e.color,.5)})}),$btnDrawShape.on("click",function(){showSubMenu("shape"),shapeType=$('[name="select-shape-type"]:checked').val(),shapeOptions.stroke="#000000",shapeOptions.fill="#ffffff",shapeOptions.strokeWidth=Number($inputStrokeWidthRange.val()),imageEditor.setDrawingShape(shapeType,shapeOptions),activateShapeMode()}),$selectShapeType.on("change",function(){shapeType=$(this).val(),imageEditor.setDrawingShape(shapeType)}),$inputCheckTransparent.on("change",function(){var e,t=$selectColorType.val();e=$(this).prop("checked")?"transparent":shapeColorpicker.getColor(),"stroke"===t?imageEditor.changeShape(activeObjectId,{stroke:e}):"fill"===t&&imageEditor.changeShape(activeObjectId,{fill:e}),imageEditor.setDrawingShape(shapeType,shapeOptions)}),shapeColorpicker.on("selectColor",function(e){var t=$selectColorType.val(),n=$inputCheckTransparent.prop("checked"),i=e.color;n||("stroke"===t?imageEditor.changeShape(activeObjectId,{stroke:i}):"fill"===t&&imageEditor.changeShape(activeObjectId,{fill:i}),imageEditor.setDrawingShape(shapeType,shapeOptions))}),$inputStrokeWidthRange.on("change",function(){var e=Number($(this).val());imageEditor.changeShape(activeObjectId,{strokeWidth:e}),imageEditor.setDrawingShape(shapeType,shapeOptions)}),$btnText.on("click",function(){showSubMenu("text"),activateTextMode()}),$inputFontSizeRange.on("change",function(){imageEditor.changeTextStyle(activeObjectId,{fontSize:parseInt(this.value,10)})}),$btnTextStyle.on("click",function(e){var t,n=$(this).attr("data-style-type");switch(e.stopPropagation(),n){case"b":t={fontWeight:"bold"};break;case"i":t={fontStyle:"italic"};break;case"u":t={textDecoration:"underline"};break;case"l":t={textAlign:"left"};break;case"c":t={textAlign:"center"};break;case"r":t={textAlign:"right"};break;default:t={}}imageEditor.changeTextStyle(activeObjectId,t)}),textColorpicker.on("selectColor",function(e){imageEditor.changeTextStyle(activeObjectId,{fill:e.color})}),$btnAddIcon.on("click",function(){showSubMenu("icon"),activateIconMode()}),$btnRegisterIcon.on("click",function(){$iconSubMenu.find(".menu-item").eq(3).after('<li id="customArrow" class="menu-item icon-text" data-icon-type="customArrow">↑</li>'),imageEditor.registerIcons({customArrow:"M 60 0 L 120 60 H 90 L 75 45 V 180 H 45 V 45 L 30 60 H 0 Z"}),$btnRegisterIcon.off("click"),$iconSubMenu.on("click","#customArrow",onClickIconSubMenu)}),$iconSubMenu.on("click",".icon-text",onClickIconSubMenu),$btnMaskFilter.on("click",function(){imageEditor.stopDrawingMode(),$displayingSubMenu.hide(),$displayingSubMenu=$filterSubMenu.show()}),$btnImageFilter.on("click",function(){var e={grayscale:$inputCheckGrayscale,invert:$inputCheckInvert,sepia:$inputCheckSepia,sepia2:$inputCheckSepia2,blur:$inputCheckBlur,shapren:$inputCheckSharpen,emboss:$inputCheckEmboss,removeWhite:$inputCheckRemoveWhite,brightness:$inputCheckBrightness,noise:$inputCheckNoise,gradientTransparency:$inputCheckGradientTransparency,pixelate:$inputCheckPixelate,tint:$inputCheckTint,multiply:$inputCheckMultiply,blend:$inputCheckBlend,colorFilter:$inputCheckColorFilter};tui.util.forEach(e,function(e,t){e.prop("checked",imageEditor.hasFilter(t))}),$displayingSubMenu.hide(),$displayingSubMenu=$imageFilterSubMenu.show()}),$btnLoadMaskImage.on("change",function(){var t,e;supportingFileAPI||alert("This browser does not support file-api"),(t=event.target.files[0])&&(e=URL.createObjectURL(t),imageEditor.loadImageFromURL(imageEditor.toDataURL(),"FilterImage").then(function(){imageEditor.addImageObject(e).then(function(e){URL.revokeObjectURL(t),console.log(e)})}))}),$btnApplyMask.on("click",function(){imageEditor.applyFilter("mask",{maskObjId:activeObjectId}).then(function(e){console.log(e)})}),$inputCheckGrayscale.on("change",function(){applyOrRemoveFilter(this.checked,"Grayscale",null)}),$inputCheckInvert.on("change",function(){applyOrRemoveFilter(this.checked,"Invert",null)}),$inputCheckSepia.on("change",function(){applyOrRemoveFilter(this.checked,"Sepia",null)}),$inputCheckSepia2.on("change",function(){applyOrRemoveFilter(this.checked,"Sepia2",null)}),$inputCheckBlur.on("change",function(){applyOrRemoveFilter(this.checked,"Blur",null)}),$inputCheckSharpen.on("change",function(){applyOrRemoveFilter(this.checked,"Sharpen",null)}),$inputCheckEmboss.on("change",function(){applyOrRemoveFilter(this.checked,"Emboss",null)}),$inputCheckRemoveWhite.on("change",function(){applyOrRemoveFilter(this.checked,"removeWhite",{threshold:parseInt($inputRangeRemoveWhiteThreshold.val(),10),distance:parseInt($inputRangeRemoveWhiteDistance.val(),10)})}),$inputRangeRemoveWhiteThreshold.on("change",function(){applyOrRemoveFilter($inputCheckRemoveWhite.is(":checked"),"removeWhite",{threshold:parseInt(this.value,10)})}),$inputRangeRemoveWhiteDistance.on("change",function(){applyOrRemoveFilter($inputCheckRemoveWhite.is(":checked"),"removeWhite",{distance:parseInt(this.value,10)})}),$inputCheckBrightness.on("change",function(){applyOrRemoveFilter(this.checked,"brightness",{brightness:parseInt($inputRangeBrightnessValue.val(),10)})}),$inputRangeBrightnessValue.on("change",function(){applyOrRemoveFilter($inputCheckBrightness.is(":checked"),"brightness",{brightness:parseInt(this.value,10)})}),$inputCheckNoise.on("change",function(){applyOrRemoveFilter(this.checked,"noise",{noise:parseInt($inputRangeNoiseValue.val(),10)})}),$inputRangeNoiseValue.on("change",function(){applyOrRemoveFilter($inputCheckNoise.is(":checked"),"noise",{noise:parseInt(this.value,10)})}),$inputCheckGradientTransparency.on("change",function(){applyOrRemoveFilter(this.checked,"gradientTransparency",{threshold:parseInt($inputRangeGradientTransparencyValue.val(),10)})}),$inputRangeGradientTransparencyValue.on("change",function(){applyOrRemoveFilter($inputCheckGradientTransparency.is(":checked"),"gradientTransparency",{threshold:parseInt(this.value,10)})}),$inputCheckPixelate.on("change",function(){applyOrRemoveFilter(this.checked,"pixelate",{blocksize:parseInt($inputRangePixelateValue.val(),10)})}),$inputRangePixelateValue.on("change",function(){applyOrRemoveFilter($inputCheckPixelate.is(":checked"),"pixelate",{blocksize:parseInt(this.value,10)})}),$inputCheckTint.on("change",function(){applyOrRemoveFilter(this.checked,"tint",{color:tintColorpicker.getColor(),opacity:parseFloat($inputRangeTintOpacityValue.val())})}),tintColorpicker.on("selectColor",function(e){applyOrRemoveFilter($inputCheckTint.is(":checked"),"tint",{color:e.color})}),$inputRangeTintOpacityValue.on("change",function(){applyOrRemoveFilter($inputCheckTint.is(":checked"),"tint",{opacity:parseFloat($inputRangeTintOpacityValue.val())})}),$inputCheckMultiply.on("change",function(){applyOrRemoveFilter(this.checked,"multiply",{color:multiplyColorpicker.getColor()})}),multiplyColorpicker.on("selectColor",function(e){applyOrRemoveFilter($inputCheckMultiply.is(":checked"),"multiply",{color:e.color})}),$inputCheckBlend.on("change",function(){applyOrRemoveFilter(this.checked,"blend",{color:blendColorpicker.getColor(),mode:$selectBlendType.val()})}),blendColorpicker.on("selectColor",function(e){applyOrRemoveFilter($inputCheckBlend.is(":checked"),"blend",{color:e.color})}),$selectBlendType.on("change",function(){applyOrRemoveFilter($inputCheckBlend.is(":checked"),"blend",{mode:this.value})}),$inputCheckColorFilter.on("change",function(){applyOrRemoveFilter(this.checked,"colorFilter",{color:"#FFFFFF",threshold:$inputRangeColorFilterValue.val()})}),$inputRangeColorFilterValue.on("change",function(){applyOrRemoveFilter($inputCheckColorFilter.is(":checked"),"colorFilter",{threshold:this.value})}),$(".menu").on("selectstart",function(){return!1});